<!-- Add Mulish font -->
<link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;700&display=swap" rel="stylesheet">

<style>
/* Subtitle and month headers with Mulish */
p.subtitle, h2 {
  font-family: 'Mulish', sans-serif;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script> <!-- For robust CSV parsing -->

<script>
fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
    const data = parsed.data.map(d => ({
      date: d['Date'].trim(),
      recognized: d['Recognized'].trim(),
      praise: d['Praise'].trim()
    }));

    // Sort by newest first
    data.sort((a,b) => new Date(b.date) - new Date(a.date));

    const container = document.getElementById("kudosContainer");

    // --- Recent Comments Section ---
    const recentHeader = document.createElement("h2");
    recentHeader.textContent = "ðŸŒŸ Recent Comments";
    container.appendChild(recentHeader);

    const recentGrid = document.createElement("div");
    recentGrid.id = "kudosCards";
    data.slice(0,3).forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<strong>${p.recognized}</strong><p>${p.praise}</p>`;
      recentGrid.appendChild(card);
    });
    container.appendChild(recentGrid);

    // --- Group by Month ---
    const grouped = {};
    data.forEach(d => {
      const month = getMonthName(d.date);
      if (!grouped[month]) grouped[month] = [];
      grouped[month].push(d);
    });

    Object.keys(grouped)
      .sort((a,b) => new Date(grouped[b][0].date) - new Date(grouped[a][0].date))
      .forEach(month => {
        const monthHeader = document.createElement("h2");
        monthHeader.textContent = month;
        container.appendChild(monthHeader);

        const monthGrid = document.createElement("div");
        monthGrid.id = "kudosCards";

        grouped[month].forEach(p => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<strong>${p.recognized}</strong><p>${p.praise}</p>`;
          monthGrid.appendChild(card);

          confetti({ particleCount: 10, spread: 70, origin: { y: 0.6 } });
        });

        container.appendChild(monthGrid);
    });

    // Animate cards
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if(entry.isIntersecting) entry.target.classList.add("visible");
      });
    }, { threshold: 0.2 });

    document.querySelectorAll(".card").forEach(card => observer.observe(card));
  });
</script>
